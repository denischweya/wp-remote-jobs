(()=>{function e(e,o){o.className.includes("job-listings-")?o.className=o.className.replace(/job-listings-(grid|list)/,`job-listings-${e}`):o.className=`job-listings-${e}`}function o(e,o){e.forEach((e=>{e.dataset.layout===o?e.classList.add("active"):e.classList.remove("active")}))}jQuery(document).ready((function(t){console.log("Job List Script Loaded"),console.log("remjobsAjax available:","undefined"!=typeof remjobsAjax);let n=!1;"undefined"==typeof remjobsAjax?(console.warn("remjobsAjax not found, creating fallback..."),window.remjobsAjax={ajaxurl:"/wp-admin/admin-ajax.php",nonce:""},"undefined"!=typeof ajaxurl?window.remjobsAjax.ajaxurl=ajaxurl:"undefined"!=typeof wpApiSettings&&wpApiSettings.root&&(window.remjobsAjax.ajaxurl=wpApiSettings.root+"wp/v2/"),t.ajax({url:window.remjobsAjax.ajaxurl,type:"POST",data:{action:"get_filter_nonce"},success:function(e){e.success&&e.data.nonce?(window.remjobsAjax.nonce=e.data.nonce,window.remjobsAjax.ajaxurl=e.data.ajaxurl,n=!0,console.log("Successfully retrieved nonce from server:",window.remjobsAjax)):(console.warn("Failed to get nonce from server:",e),n=!0)},error:function(e,o,t){console.warn("Error getting nonce from server:",o,t),n=!0}}),console.log("Created fallback remjobsAjax:",window.remjobsAjax)):n=!0,"undefined"!=typeof remjobsAjax?console.log("remjobsAjax:",remjobsAjax):(console.error("remjobsAjax is still not available after fallback!"),console.log("Available global variables:",Object.keys(window)));const s=t("#jobs-list"),a=t("#job-search"),l=t("#job-category"),r=t("#job-location"),c=t("#job-skills"),i=t("#filter-jobs");function u(){if(console.log("=== updateJobs function called ==="),!n)return console.log("AJAX system not ready yet, waiting..."),void setTimeout((function(){u()}),500);if("undefined"==typeof remjobsAjax)return void console.error("remjobsAjax is not available in updateJobs function");console.log("remjobsAjax in updateJobs:",remjobsAjax);const e=a.val()||"",o=l.val()||"",i=r.val()||"",d=c.val()||"";console.log("Filter values:"),console.log("- Search:",e),console.log("- Category:",o),console.log("- Location:",i),console.log("- Skills:",d);const g=s.find('[class*="job-listings-"]');let j="grid";g.length&&(g.hasClass("job-listings-list")?j="list":g.hasClass("job-listings-grid")&&(j="grid")),console.log("Current layout:",j),s.html('<div class="loading">Loading jobs...</div>');const b={action:"filter_jobs",nonce:remjobsAjax.nonce,search:e,category:o,location:i,skills:d,layout:j};console.log("AJAX data being sent:",b),console.log("AJAX URL:",remjobsAjax.ajaxurl),b.nonce&&""!==b.nonce||console.warn("No nonce available, but proceeding (debug mode should handle this)"),t.ajax({url:remjobsAjax.ajaxurl,type:"POST",data:b,beforeSend:function(){console.log("AJAX request starting...")},success:function(e){console.log("AJAX Success response:",e),e.success?(console.log("Response data:",e.data),s.html(e.data.data),console.log("Jobs updated successfully. Found:",e.data.found,"posts")):(console.error("AJAX returned success=false:",e),s.html('<div class="error">Error loading jobs: '+(e.data.message||"Unknown error")+"</div>"))},error:function(e,o,n){console.error("AJAX Error:"),console.error("- Status:",o),console.error("- Error:",n),console.error("- Response:",e.responseText),console.error("- Status Code:",e.status),400!==e.status||remjobsAjax.nonce||(console.log("Trying to get a fresh nonce..."),t.ajax({url:remjobsAjax.ajaxurl,type:"POST",data:{action:"get_filter_nonce"},success:function(e){if(e.success&&e.data.nonce)return remjobsAjax.nonce=e.data.nonce,console.log("Got fresh nonce, retrying filter request..."),void setTimeout(u,100)}})),s.html('<div class="error">Error loading jobs. Please try again.</div>')},complete:function(){console.log("AJAX request completed")}})}t(".job-search-form"),console.log("DOM Elements Found:"),console.log("- Job List Container (#jobs-list):",s.length),console.log("- Search Input (#job-search):",a.length),console.log("- Category Select (#job-category):",l.length),console.log("- Location Select (#job-location):",r.length),console.log("- Skills Select (#job-skills):",c.length),console.log("- Filter Button (#filter-jobs):",i.length),i.length&&i.on("click",(function(e){e.preventDefault(),console.log("Filter button clicked"),console.log("Current filter values:",{search:a.val(),category:l.val(),skills:c.val(),location:r.val()}),u()})),a.on("keyup",function(e){let o;return function(...t){clearTimeout(o),o=setTimeout((()=>{clearTimeout(o),e(...t)}),500)}}(u)),l.on("change",(function(){console.log("Category changed to:",t(this).val()),u()})),r.on("change",(function(){console.log("Location changed to:",t(this).val()),u()})),c.on("change",(function(){console.log("Skills changed to:",t(this).val()),u()}));const d=t(".layout-toggle button");d.length&&d.on("click",(function(){const e=t(this).data("layout");s.removeClass("grid list").addClass(e),d.removeClass("is-primary").addClass("is-secondary"),t(this).removeClass("is-secondary").addClass("is-primary")}));const g=document.querySelectorAll(".job-listings-container");g.length&&(g.forEach((t=>{const n=t.id,s=t.querySelectorAll(".layout-button"),a=t.querySelector('[class^="job-listings-"]');if(!s.length||!a)return;const l=t.dataset.layout||"grid";let r=function(e){return"undefined"!=typeof localStorage?localStorage.getItem(`remjobs_layout_${e}`):null}(n)||l;e(r,a),o(s,r),s.forEach((t=>{t.addEventListener("click",(()=>{const l=t.dataset.layout;l!==r&&(e(l,a),o(s,l),function(e,o){"undefined"!=typeof localStorage&&localStorage.setItem(`remjobs_layout_${e}`,o)}(n,l),r=l)}))})),function(e){const o=e.querySelector(".filter-button"),t=e.querySelector(".category-select"),n=e.querySelector(".location-select"),s=e.querySelector(".skills-select"),a=e.querySelector(".search-input");if(!o)return;const l=new URLSearchParams(window.location.search);a&&l.has("search")&&(a.value=l.get("search")),t&&l.has("category")&&(t.value=l.get("category")),n&&l.has("location")&&(n.value=l.get("location")),s&&l.has("skills")&&(s.value=l.get("skills")),o.addEventListener("click",(()=>{const e=t?t.value:"",o=n?n.value:"",l=s?s.value:"",r=a?a.value:"",c=new URL(window.location.href);e?c.searchParams.set("category",e):c.searchParams.delete("category"),o?c.searchParams.set("location",o):c.searchParams.delete("location"),l?c.searchParams.set("skills",l):c.searchParams.delete("skills"),r?c.searchParams.set("search",r):c.searchParams.delete("search"),window.location.href=c.toString()}))}(t)})),document.querySelectorAll(".save-job-button").forEach((e=>{e.addEventListener("click",(o=>{o.preventDefault();const t=e.dataset.jobId;t&&(e.classList.toggle("saved"),console.log("Toggle saved state for job ID:",t))}))})))})),document.addEventListener("DOMContentLoaded",(function(){document.querySelectorAll(".job-card.premium, .job-row.premium").forEach((e=>{const o=document.createElement("div");o.className="premium-indicator",o.innerHTML='\n\t\t\t<svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">\n\t\t\t\t<path d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z"></path>\n\t\t\t</svg>\n\t\t',e.appendChild(o)}))})),document.addEventListener("DOMContentLoaded",(function(){document.querySelectorAll(".save-job-button").forEach((e=>{e.addEventListener("click",(function(o){o.preventDefault();const t=e.querySelector("svg");"none"===t.getAttribute("fill")?(t.setAttribute("fill","currentColor"),e.setAttribute("title","Saved")):(t.setAttribute("fill","none"),e.setAttribute("title","Save job"))}))}))}))})();